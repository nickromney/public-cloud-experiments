# Example configuration for the Easy Auth React stack
# Copy to terraform.tfvars and replace placeholder values.

environment         = "dev"
project_name        = "subnetcalc"
workload_name       = "subnet-calculator-react-webapp-easyauth"
resource_group_name = "rg-subnet-calc"

service_plans = {
  func = {
    name     = "plan-subnetcalc-dev-func-easyauth"
    os_type  = "Linux"
    sku_name = "EP1"
  }
  web = {
    name     = "plan-subnetcalc-dev-web-easyauth"
    os_type  = "Linux"
    sku_name = "B1"
  }
}

storage_accounts = {
  funcapp = {
    name                     = "stsubnetcalceasyauth"
    account_tier             = "Standard"
    account_replication_type = "LRS"
    account_kind             = "StorageV2"
  }
}

log_analytics_workspaces          = {}
shared_log_analytics_workspace_id = "/subscriptions/<sub-id>/resourceGroups/rg-subnet-calc/providers/Microsoft.OperationalInsights/workspaces/log-subnetcalc-shared-dev"

application_insights = {
  easyauth = {
    name             = "appi-subnetcalc-react-webapp-easyauth"
    application_type = "web"
  }
}

entra_id_apps = {
  frontend = {
    display_name     = "Subnet Calculator React Web App"
    sign_in_audience = "AzureADMyOrg"
    identifier_uris  = ["api://subnet-calculator-react-easyauth"]
    web_redirect_uris = [
      "https://web-subnet-calc-react-easyauth.azurewebsites.net/.auth/login/aad/callback"
    ]
  }
}

function_apps = {
  api = {
    name                = "func-subnet-calc-react-easyauth-api"
    service_plan_key    = "func"
    runtime             = "python"
    runtime_version     = "3.11"
    storage_account_key = "funcapp"
    app_insights_key    = "easyauth"
    cors_allowed_origins = ["https://web-subnet-calc-react-easyauth.azurewebsites.net"]
    app_settings = {
      AUTH_METHOD            = "jwt"
      JWT_SECRET_KEY         = "change-me"
      JWT_ALGORITHM          = "HS256"
      AzureWebJobsFeatureFlags = "EnableWorkerIndexing"
    }
  }
}

web_apps = {
  frontend = {
    name             = "web-subnet-calc-react-easyauth"
    service_plan_key = "web"
    runtime          = "node"
    runtime_version  = "22-lts"
    startup_file     = "node server.js"
    always_on        = true
    app_insights_key = "easyauth"
    app_settings = {
      STACK_NAME                     = "Subnet Calculator React (Easy Auth)"
      AUTH_METHOD                    = "easyauth"
      WEBSITE_NODE_DEFAULT_VERSION   = "~22"
      SCM_DO_BUILD_DURING_DEPLOYMENT = "true"
      WEBSITE_RUN_FROM_PACKAGE       = "0"
    }
    easy_auth = {
      enabled           = true
      entra_app_key     = "frontend"
      allowed_audiences = ["api://subnet-calculator-react-easyauth"]
    }
  }
}
