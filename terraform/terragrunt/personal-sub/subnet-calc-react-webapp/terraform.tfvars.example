# Copy to terraform.tfvars and update the placeholders before running terragrunt.

web_app = {
  plan_sku        = "P1v3"
  runtime_version = "18-lts"
  api_base_url    = ""
  always_on       = true
  app_settings = {
    STACK_NAME = "Subnet Calculator React (Easy Auth with Managed Identity)"
  }
  # Easy Auth with Managed Identity (no client secret needed)
  easy_auth = {
    client_id     = "00000000-0000-0000-0000-000000000000"
    tenant_id     = "<tenant-id>"
    issuer        = "https://login.microsoftonline.com/<tenant-id>/v2.0"
    allowed_audiences = [
      "api://subnet-calculator-react"
    ]
    use_managed_identity = true
    login_parameters     = {}
  }
}

function_app = {
  plan_sku             = "EP1"
  runtime              = "python"
  runtime_version      = "3.11"
  run_from_package     = true
  storage_account_name = ""
  cors_allowed_origins = [
    "https://web-cloud-exp-dev-react.azurewebsites.net",
    "http://localhost:5173",
    "http://localhost:4173"
  ]
  app_settings = {
    # JWT Authentication Configuration
    AUTH_METHOD                     = "jwt"
    # WARNING: Change this secret for any deployment! For production, use Azure Key Vault (see PASSWORD-HASH-ESCAPING.md)
    JWT_SECRET_KEY                  = "dev-secret-key-minimum-32-characters-long-for-security"
    JWT_ALGORITHM                   = "HS256"
    JWT_ACCESS_TOKEN_EXPIRE_MINUTES = "30"

    # WARNING: These are DEMO credentials only (demo/password123, admin/securepass). DO NOT use in production! For production, use Azure Key Vault.
    # Argon2 hashed passwords (demo=password123, admin=securepass)
    # IMPORTANT: Use SINGLE $ in Terraform tfvars (no escaping needed)
    # The same hash in Docker Compose requires $$ escaping
    JWT_TEST_USERS = "{\"demo\":\"$argon2id$v=19$m=65536,t=3,p=4$TklhcmEkyMzqJaH3KHQQDA$rgp8AmtaR6PzBgjyZGNsivb2yJRqULRt5B+BmzUnzbo\",\"admin\":\"$argon2id$v=19$m=65536,t=3,p=4$JiTJZlTwD/1jJLlMQMOwCA$HbubnE11kzEfcszqKtMOmjvxj14vjooqbdZtgc1NYCs\"}"

    # Azure Function configuration
    AzureWebJobsFeatureFlags = "EnableWorkerIndexing"
    # NOTE: Do NOT set ENABLE_ORYX_BUILD or WEBSITE_RUN_FROM_PACKAGE
    # SCM_DO_BUILD_DURING_DEPLOYMENT is set to true in Terraform (main.tf:113) to enable remote builds
  }
}

# -----------------------------------------------------------------------------
# Stage Overlays
# -----------------------------------------------------------------------------
# The stages/ directory contains layered configuration files for progressive
# infrastructure deployment. Apply them with:
#
#   terragrunt plan -- -var-file=stages/200-create-observability.tfvars
#
# Provided overlays:
# - stages/100-minimal.tfvars              → minimal inputs to unblock non-interactive
#   plans with basic settings.
# - stages/200-create-observability.tfvars → flips observability.use_existing to false
#   and sets create_resource_group = true so the stack stands alone.
# - stages/300-byo-platform.tfvars         → reuses shared plans/storage via the new
#   existing_service_plan_id/existing_storage_account_id inputs.
#
# Copy and tweak these files as you progress through environments to document
# which resources are created vs. imported.
